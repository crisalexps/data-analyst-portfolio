import pandas as pd
import matplotlib.pyplot as plt
import os

# Crear carpeta para gráficos
os.makedirs('output/plots', exist_ok=True)

# Cargar datos
df = pd.read_csv('data/raw/sales_data.csv')
df['date'] = pd.to_datetime(df['date'], errors='coerce')
df['total_sales'] = df['quantity'] * df['price']
df.dropna(subset=['order_id','date','product','category','quantity','price'], inplace=True)

# Métricas generales
total_revenue = df['total_sales'].sum()
total_orders = df['order_id'].nunique()
avg_ticket = total_revenue / total_orders

print(f"Total Revenue: ${total_revenue:,.2f}")
print(f"Total Orders: {total_orders}")
print(f"Average Ticket: ${avg_ticket:,.2f}")

# Ventas por categoría
sales_by_category = df.groupby('category')['total_sales'].sum().sort_values(ascending=False)
sales_by_category.plot(kind='bar', color='skyblue', title='Ventas por Categoría')
plt.ylabel('Ingresos')
plt.savefig('output/plots/sales_by_category.png')
plt.show()

# Ventas mensuales
df['month'] = df['date'].dt.to_period('M')
monthly_sales = df.groupby('month')['total_sales'].sum()
monthly_sales.plot(marker='o', color='green', title='Tendencia Mensual de Ventas')
plt.ylabel('Ingresos')
plt.savefig('output/plots/monthly_sales_trend.png')
plt.show()

# Top 5 productos
top_products = df.groupby('product')['total_sales'].sum().sort_values(ascending=False).head(5)
top_products.plot(kind='bar', color='orange', title='Top 5 Productos')
plt.ylabel('Ingresos')
plt.savefig('output/plots/top_products.png')
plt.show()

# Sales Analysis

## Objetivo
Analizar ventas por categoría, producto y mes.

## Dataset
`data/raw/sales_data.csv` – order_id, date, customer_id, product, category, quantity, price, region

## Herramientas
Python, Pandas, Matplotlib, Jupyter Notebook

## Salida
- Métricas: Total Revenue, Total Orders, Average Ticket  
- Gráficos: ventas por categoría, tendencia mensual, top 5 productos (`output/plots`)

## Notebook
`notebooks/01_sales_analysis.ipynb`
